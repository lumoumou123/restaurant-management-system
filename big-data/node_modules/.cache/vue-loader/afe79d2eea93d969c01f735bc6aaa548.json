{"remainingRequest":"C:\\Users\\18167\\Desktop\\final year\\big-data\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\18167\\Desktop\\final year\\big-data\\src\\views\\RestaurantManagement.vue?vue&type=style&index=0&id=2822f69a&scoped=true&lang=css","dependencies":[{"path":"C:\\Users\\18167\\Desktop\\final year\\big-data\\src\\views\\RestaurantManagement.vue","mtime":1744630938671},{"path":"C:\\Users\\18167\\Desktop\\final year\\big-data\\node_modules\\css-loader\\dist\\cjs.js","mtime":1742859681121},{"path":"C:\\Users\\18167\\Desktop\\final year\\big-data\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":1742859685007},{"path":"C:\\Users\\18167\\Desktop\\final year\\big-data\\node_modules\\postcss-loader\\src\\index.js","mtime":1742859682771},{"path":"C:\\Users\\18167\\Desktop\\final year\\big-data\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1742859679583},{"path":"C:\\Users\\18167\\Desktop\\final year\\big-data\\node_modules\\vue-loader\\lib\\index.js","mtime":1742859683968}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ci5yZXN0YXVyYW50LW1hbmFnZW1lbnQgewogIHBhZGRpbmc6IDIwcHg7CiAgbWF4LXdpZHRoOiAxMjAwcHg7CiAgbWFyZ2luOiAwIGF1dG87Cn0KCmgyIHsKICBtYXJnaW4tYm90dG9tOiAyMHB4OwogIGNvbG9yOiAjMzMzOwp9CgpoMyB7CiAgbWFyZ2luLWJvdHRvbTogMTVweDsKICBjb2xvcjogIzY2NjsKfQoKLnJlc3RhdXJhbnQtZm9ybSB7CiAgYmFja2dyb3VuZDogI2Y5ZjlmOTsKICBwYWRkaW5nOiAyMHB4OwogIGJvcmRlci1yYWRpdXM6IDhweDsKICBtYXJnaW4tYm90dG9tOiAzMHB4Owp9CgoubG9jYXRpb24taW5wdXRzIHsKICBkaXNwbGF5OiBmbGV4OwogIGdhcDogMTBweDsKICBtYXJnaW4tYm90dG9tOiAxMHB4Owp9CgoubG9jYXRpb24taW5wdXQgewogIHdpZHRoOiA1MCU7Cn0KCi5tYXAtY29udGFpbmVyIHsKICBwb3NpdGlvbjogcmVsYXRpdmU7CiAgbWFyZ2luLXRvcDogMTBweDsKICBib3JkZXI6IDFweCBzb2xpZCAjZGRkOwogIGJvcmRlci1yYWRpdXM6IDRweDsKICBvdmVyZmxvdzogaGlkZGVuOwp9CgoubWFwLWVycm9yIHsKICBwb3NpdGlvbjogYWJzb2x1dGU7CiAgdG9wOiA1MCU7CiAgbGVmdDogNTAlOwogIHRyYW5zZm9ybTogdHJhbnNsYXRlKC01MCUsIC01MCUpOwogIGJhY2tncm91bmQtY29sb3I6IHJnYmEoMjU1LCAwLCAwLCAwLjcpOwogIGNvbG9yOiB3aGl0ZTsKICBwYWRkaW5nOiA4cHggMTZweDsKICBib3JkZXItcmFkaXVzOiA0cHg7Cn0KCi5tYXAtdGlwIHsKICBjb2xvcjogIzkwOTM5OTsKICBmb250LXNpemU6IDEycHg7CiAgbWFyZ2luLWJvdHRvbTogNXB4Owp9CgoucmVzdGF1cmFudC1saXN0IHsKICBtYXJnaW4tdG9wOiAzMHB4Owp9CgouY29tYmluZWQtaW5wdXQgewogIG1hcmdpbi1ib3R0b206IDEwcHg7CiAgYm9yZGVyOiAxcHggc29saWQgI2RjZGZlNjsKICBib3JkZXItcmFkaXVzOiA0cHg7CiAgcGFkZGluZzogMTBweDsKICBiYWNrZ3JvdW5kLWNvbG9yOiAjZjVmN2ZhOwp9CgouY29tYmluZWQtaW5wdXQgOmRlZXAoLmVsLWlucHV0X19pbm5lcikgewogIGZvbnQtZmFtaWx5OiBtb25vc3BhY2U7CiAgZm9udC1zaXplOiAxNHB4Owp9CgouY29tYmluZWQtaW5wdXQgOmRlZXAoLmVsLWlucHV0LWdyb3VwX19hcHBlbmQpIHsKICBiYWNrZ3JvdW5kLWNvbG9yOiAjNDA5RUZGOwogIGJvcmRlci1jb2xvcjogIzQwOUVGRjsKICBjb2xvcjogd2hpdGU7Cn0K"},{"version":3,"sources":["RestaurantManagement.vue"],"names":[],"mappings":";AA2tBA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA","file":"RestaurantManagement.vue","sourceRoot":"src/views","sourcesContent":["<template>\n  <div class=\"restaurant-management\">\n    <h2>Restaurant Management</h2>\n    \n    <!-- Restaurant Form -->\n    <div class=\"restaurant-form\">\n      <h3>{{ editMode ? 'Edit Restaurant' : 'Add New Restaurant' }}</h3>\n      <el-form :model=\"restaurantForm\" label-width=\"120px\">\n        <el-form-item label=\"Name\" required>\n          <el-input v-model=\"restaurantForm.name\" placeholder=\"Restaurant Name\"></el-input>\n        </el-form-item>\n        \n        <el-form-item label=\"Address\" required>\n          <el-input v-model=\"restaurantForm.address\" placeholder=\"Restaurant Address\"></el-input>\n        </el-form-item>\n        \n        <el-form-item label=\"Business Hours\">\n          <el-input v-model=\"restaurantForm.businessHours\" placeholder=\"e.g. 9:00-22:00\"></el-input>\n        </el-form-item>\n        \n        <el-form-item label=\"Cuisine Type\">\n          <el-select v-model=\"restaurantForm.style\" placeholder=\"Select Cuisine Type\">\n            <el-option label=\"Chinese\" value=\"Chinese\"></el-option>\n            <el-option label=\"Western\" value=\"Western\"></el-option>\n            <el-option label=\"Japanese\" value=\"Japanese\"></el-option>\n            <el-option label=\"Home Style\" value=\"Home Style\"></el-option>\n          </el-select>\n        </el-form-item>\n        \n        <el-form-item label=\"Price Range\">\n          <el-select v-model=\"restaurantForm.price\" placeholder=\"Select Price Range\">\n            <el-option label=\"Low\" value=\"Low\"></el-option>\n            <el-option label=\"Medium\" value=\"Medium\"></el-option>\n            <el-option label=\"High\" value=\"High\"></el-option>\n          </el-select>\n        </el-form-item>\n        \n        <el-form-item label=\"Image URL\">\n          <el-input v-model=\"restaurantForm.image\" placeholder=\"Restaurant Image URL\"></el-input>\n        </el-form-item>\n        \n        <el-form-item label=\"Location\">\n          <div class=\"combined-input\">\n            <el-input \n              v-model=\"combinedCoordinates\" \n              placeholder=\"Enter combined coordinates (lat,lng)\" \n              @input=\"splitCoordinates\"\n              @change=\"splitCoordinates\"\n            >\n              <template slot=\"append\">\n                <el-button @click=\"splitCoordinates\">Apply</el-button>\n              </template>\n            </el-input>\n          </div>\n          <div class=\"location-inputs\">\n            <el-input v-model=\"restaurantForm.lat\" placeholder=\"Latitude\" class=\"location-input\"></el-input>\n            <el-input v-model=\"restaurantForm.lng\" placeholder=\"Longitude\" class=\"location-input\"></el-input>\n            <el-button \n              size=\"small\" \n              type=\"primary\" \n              icon=\"el-icon-copy-document\" \n              @click=\"copyCoordinates\"\n              :disabled=\"!restaurantForm.lat || !restaurantForm.lng\"\n              title=\"Copy combined coordinates\"\n            >Copy</el-button>\n          </div>\n          <div class=\"map-tip\">Tip: You can pick a location on the map, enter coordinates separately, or paste combined coordinates like \"53.452940,-7.099791\"</div>\n          \n          <!-- 地图选点组件 -->\n          <div class=\"map-container\">\n            <div id=\"location-picker-map\" style=\"height: 300px; width: 100%; margin-top: 10px;\"></div>\n            <div v-if=\"mapError\" class=\"map-error\">{{ mapError }}</div>\n          </div>\n        </el-form-item>\n        \n        <!-- Owner Selection (Only for Manager) -->\n        <el-form-item v-if=\"userRole === 'Manager'\" label=\"Owner\">\n          <el-select \n            v-model=\"restaurantForm.ownerId\" \n            placeholder=\"Select Restaurant Owner\"\n            filterable\n            :disabled=\"!isNewRestaurant\"\n          >\n            <el-option\n              v-for=\"owner in owners\"\n              :key=\"owner.id\"\n              :label=\"owner.username\"\n              :value=\"owner.id\"\n            ></el-option>\n          </el-select>\n        </el-form-item>\n        \n        <el-form-item>\n          <el-button type=\"primary\" @click=\"saveRestaurant\">Save</el-button>\n          <el-button @click=\"resetForm\">Reset</el-button>\n          <el-button v-if=\"editMode\" @click=\"cancelEdit\">Cancel</el-button>\n          <el-button type=\"warning\" @click=\"goBack\">Back to Home</el-button>\n        </el-form-item>\n      </el-form>\n    </div>\n    \n    <!-- Restaurant List -->\n    <div class=\"restaurant-list\">\n      <h3>Your Restaurants</h3>\n      <el-table :data=\"restaurants\" style=\"width: 100%\">\n        <el-table-column prop=\"name\" label=\"Name\"></el-table-column>\n        <el-table-column prop=\"address\" label=\"Address\"></el-table-column>\n        <el-table-column prop=\"style\" label=\"Cuisine Type\"></el-table-column>\n        <el-table-column prop=\"price\" label=\"Price Range\"></el-table-column>\n        <el-table-column prop=\"score\" label=\"Rating\"></el-table-column>\n        <el-table-column label=\"Actions\" width=\"200\">\n          <template slot-scope=\"scope\">\n            <el-button size=\"mini\" @click=\"editRestaurant(scope.row)\">Edit</el-button>\n            <el-button \n              size=\"mini\" \n              type=\"danger\" \n              @click=\"deleteRestaurant(scope.row)\"\n              v-if=\"userRole === 'Manager'\"\n            >Delete</el-button>\n            <el-button \n              size=\"mini\" \n              type=\"success\" \n              @click=\"manageMenu(scope.row)\"\n            >Menu</el-button>\n          </template>\n        </el-table-column>\n      </el-table>\n    </div>\n  </div>\n</template>\n\n<script>\nimport axios from 'axios';\n\nexport default {\n  name: 'RestaurantManagement',\n  data() {\n    return {\n      restaurants: [],\n      owners: [],\n      restaurantForm: {\n        id: null,\n        name: '',\n        address: '',\n        businessHours: '',\n        style: '',\n        price: '',\n        score: '0',\n        image: '',\n        lat: '',\n        lng: '',\n        ownerId: null\n      },\n      editMode: false,\n      isNewRestaurant: true,\n      userRole: '',\n      userId: null,\n      map: null,\n      marker: null,\n      mapError: null,\n      addressLookupTimeout: null,\n      combinedCoordinates: ''\n    };\n  },\n  created() {\n    // Get user info from localStorage\n    this.userRole = localStorage.getItem('userRole');\n    this.userId = localStorage.getItem('userId');\n    \n    // Load restaurants based on role\n    this.loadRestaurants();\n    \n    // If manager, load owners for selection\n    if (this.userRole === 'Manager') {\n      this.loadOwners();\n    } else if (this.userRole === 'Owner') {\n      // If owner, set ownerId to current user\n      this.restaurantForm.ownerId = this.userId;\n    }\n  },\n  mounted() {\n    // 初始化地图选点器\n    this.initializeLocationPicker();\n    \n    // 当地址改变时，尝试自动定位\n    this.$watch('restaurantForm.address', (newValue) => {\n      if (newValue && newValue.length > 5) {\n        // 使用防抖，避免频繁请求\n        clearTimeout(this.addressLookupTimeout);\n        this.addressLookupTimeout = setTimeout(() => {\n          this.geocodeAddress(newValue);\n        }, 1000);\n      }\n    });\n    \n    // 监听经纬度变化，更新组合坐标\n    this.$watch('restaurantForm.lat', (newValue) => {\n      if (newValue && this.restaurantForm.lng) {\n        this.updateCombinedCoordinates();\n      }\n    });\n    \n    this.$watch('restaurantForm.lng', (newValue) => {\n      if (newValue && this.restaurantForm.lat) {\n        this.updateCombinedCoordinates();\n      }\n    });\n  },\n  methods: {\n    async loadRestaurants() {\n      try {\n        let response;\n        const token = localStorage.getItem('token');\n        const headers = token ? { 'Authorization': `Bearer ${token}` } : {};\n        \n        console.log(\"当前用户角色:\", this.userRole);\n        console.log(\"当前用户ID:\", this.userId);\n        \n        if (this.userRole === 'Manager') {\n          // Managers can see all restaurants\n          response = await axios.get('http://localhost:8080/api/canteen/list', { headers });\n        } else if (this.userRole === 'Owner') {\n          // Owner应该查看自己的餐馆\n          response = await axios.get(`http://localhost:8080/api/canteen/owner/canteens`, {\n            headers: {\n              ...headers,\n              'X-User-Id': this.userId,\n              'X-User-Role': 'Owner'\n            }\n          });\n        }\n        \n        if (response && response.data && response.data.code === 200) {\n          this.restaurants = response.data.data || [];\n          console.log(`成功加载${this.restaurants.length}家餐馆`);\n        } else {\n          this.$message.error('Failed to load restaurants: ' + (response?.data?.msg || 'Unknown error'));\n          console.error(\"加载餐馆失败:\", response?.data);\n        }\n      } catch (error) {\n        console.error('Error loading restaurants:', error);\n        console.error(\"请求失败详情:\", error.response ? error.response.data : error.message);\n        this.$message.error('Error loading restaurants: ' + (error.response?.data?.msg || error.message));\n      }\n    },\n    \n    async loadOwners() {\n      try {\n        console.log(\"开始加载餐厅业主列表...\");\n        // 先测试API是否可用\n        const testResponse = await axios.get('http://localhost:8080/api/users/test');\n        console.log(\"API测试结果:\", testResponse.data);\n        \n        // 获取角色为 'Owner' 的用户\n        const response = await axios.get('http://localhost:8080/api/users/owners');\n        console.log(\"业主列表响应:\", response.data);\n        \n        if (response.data.code === 200) {\n          this.owners = response.data.data || [];\n          console.log(\"成功加载业主:\", this.owners);\n        } else {\n          this.$message.error('Failed to load restaurant owners: ' + response.data.msg);\n          console.error(\"加载业主失败:\", response.data.msg);\n        }\n      } catch (error) {\n        console.error(\"错误详情:\", error);\n        console.error(\"请求URL:\", error.config ? error.config.url : \"未知\");\n        console.error(\"响应状态:\", error.response ? error.response.status : \"未知\");\n        console.error(\"响应数据:\", error.response ? error.response.data : \"未知\");\n        \n        // 设置一个默认业主选项以避免页面错误\n        this.owners = [{ id: 7, username: \"默认业主 (ID: 7)\" }];\n        this.$message.error('Failed to load restaurant owners: ' + (error.message || 'Unknown error'));\n      }\n    },\n    \n    async saveRestaurant() {\n      // 验证必填字段\n      if (!this.restaurantForm.name || !this.restaurantForm.address) {\n        this.$message.error('Please fill in restaurant name and address');\n        return;\n      }\n      \n      // 确保ownerId是数字类型\n      if (this.restaurantForm.ownerId) {\n        this.restaurantForm.ownerId = Number(this.restaurantForm.ownerId);\n      } else if (this.userRole === 'Owner') {\n        // 如果是业主用户，将ownerId设置为当前用户ID\n        this.restaurantForm.ownerId = Number(this.userId);\n      } else {\n        // 如果是管理员但没有选择业主，使用默认业主ID\n        this.restaurantForm.ownerId = 7;\n      }\n      \n      // 准备要发送的数据\n      let restaurantData = {...this.restaurantForm};\n      \n      // 如果是新增餐厅，删除id字段，让数据库自动生成\n      if (!this.editMode) {\n        delete restaurantData.id;\n      }\n      \n      console.log(\"准备保存餐厅数据:\", restaurantData);\n      \n      try {\n        const token = localStorage.getItem('token');\n        const headers = {\n          'Content-Type': 'application/json'\n        };\n        \n        if (token) {\n          headers['Authorization'] = `Bearer ${token}`;\n        }\n        \n        // 添加用户ID和角色到请求头\n        headers['X-User-Id'] = this.userId;\n        headers['X-User-Role'] = this.userRole;\n        \n        let url = 'http://localhost:8080/api/canteen/add';\n        let method = 'post';\n        \n        // 如果编辑，使用update接口\n        if (this.editMode) {\n          url = 'http://localhost:8080/api/canteen/update';\n        }\n        \n        console.log(\"发送请求到:\", url);\n        const response = await axios({\n          method,\n          url,\n          data: restaurantData,\n          headers\n        });\n        \n        console.log(\"保存餐厅响应:\", response.data);\n        \n        if (response.data.code === 200) {\n          this.$message.success(this.editMode ? 'Restaurant updated successfully' : 'Restaurant added successfully');\n          this.resetForm();\n          this.loadRestaurants();\n        } else {\n          this.$message.error(response.data.msg || 'Operation failed');\n          console.error(\"操作失败:\", response.data.msg);\n        }\n      } catch (error) {\n        console.error('Error saving restaurant:', error);\n        console.error(\"请求失败详情:\", error.response ? error.response.data : error.message);\n        this.$message.error('Error saving restaurant: ' + (error.response?.data?.msg || error.message));\n      }\n    },\n    \n    editRestaurant(restaurant) {\n      this.editMode = true;\n      this.isNewRestaurant = false;\n      \n      // Copy the restaurant data to the form\n      this.restaurantForm = { ...restaurant };\n      \n      // Scroll to form\n      this.$nextTick(() => {\n        const formElement = document.querySelector('.restaurant-form');\n        if (formElement) {\n          formElement.scrollIntoView({ behavior: 'smooth' });\n        }\n      });\n    },\n    \n    async deleteRestaurant(restaurant) {\n      try {\n        if (confirm('Are you sure you want to delete this restaurant?')) {\n          const token = localStorage.getItem('token');\n          const headers = {};\n          \n          if (token) {\n            headers['Authorization'] = `Bearer ${token}`;\n          }\n          \n          // 添加用户ID和角色到请求头\n          headers['X-User-Id'] = this.userId;\n          headers['X-User-Role'] = this.userRole;\n          \n          const response = await axios.delete(\n            `http://localhost:8080/api/canteen/delete/${restaurant.id}`, \n            { headers }\n          );\n          \n          if (response.data.code === 200) {\n            this.$message.success('Restaurant deleted successfully');\n            this.loadRestaurants();\n          } else {\n            this.$message.error(response.data.msg || 'Failed to delete restaurant');\n          }\n        }\n      } catch (error) {\n        console.error('Error deleting restaurant:', error);\n        console.error(\"请求失败详情:\", error.response ? error.response.data : error.message);\n        this.$message.error('Error deleting restaurant: ' + (error.response?.data?.msg || error.message));\n      }\n    },\n    \n    resetForm() {\n      this.restaurantForm = {\n        id: null,\n        name: '',\n        address: '',\n        businessHours: '',\n        style: '',\n        price: '',\n        score: '0',\n        image: '',\n        lat: '',\n        lng: '',\n        ownerId: this.userRole === 'Owner' ? this.userId : null\n      };\n      this.editMode = false;\n      this.isNewRestaurant = true;\n    },\n    \n    cancelEdit() {\n      this.resetForm();\n    },\n    \n    goBack() {\n      this.$router.push('/');\n    },\n    \n    initializeLocationPicker() {\n      // 检查Google Maps API是否已加载\n      if (window.google && window.google.maps) {\n        this.initMap();\n      } else {\n        // 如果Google Maps API尚未加载，添加错误消息\n        this.mapError = 'Loading Google Maps...';\n        console.log('Google Maps API not loaded, attempting to load');\n        \n        // 尝试通过动态添加脚本加载\n        const script = document.createElement('script');\n        script.src = `https://maps.googleapis.com/maps/api/js?key=${process.env.VUE_APP_GOOGLE_MAPS_API_KEY}&language=en&region=IE&callback=initLocationPickerMap`;\n        script.async = true;\n        script.defer = true;\n        \n        // 全局回调函数\n        window.initLocationPickerMap = () => {\n          this.initMap();\n        };\n        \n        document.head.appendChild(script);\n      }\n    },\n    \n    initMap() {\n      const mapContainer = document.getElementById(\"location-picker-map\");\n      if (!mapContainer) {\n        this.mapError = 'Map container not found';\n        console.error(\"Map container not found!\");\n        return;\n      }\n\n      try {\n        // 默认中心位置 - 爱尔兰中心\n        const center = { lat: 53.41291, lng: -8.24389 };\n        \n        // 如果表单中已有经纬度，使用表单中的值\n        if (this.restaurantForm.lat && this.restaurantForm.lng) {\n          center.lat = parseFloat(this.restaurantForm.lat);\n          center.lng = parseFloat(this.restaurantForm.lng);\n        }\n        \n        // 创建自定义的地图类型控件\n        const customMapTypeControlDiv = document.createElement('div');\n        customMapTypeControlDiv.className = 'custom-map-type-control';\n        customMapTypeControlDiv.style.padding = '5px';\n        customMapTypeControlDiv.style.display = 'flex';\n        customMapTypeControlDiv.style.backgroundColor = 'white';\n        customMapTypeControlDiv.style.boxShadow = '0 1px 4px rgba(0,0,0,0.3)';\n        customMapTypeControlDiv.style.borderRadius = '2px';\n        customMapTypeControlDiv.style.margin = '10px';\n        customMapTypeControlDiv.style.zIndex = '1';\n        \n        // 创建地图按钮\n        const mapButton = document.createElement('div');\n        mapButton.textContent = 'Map';\n        mapButton.style.padding = '8px 16px';\n        mapButton.style.cursor = 'pointer';\n        mapButton.style.fontFamily = 'Arial, sans-serif';\n        mapButton.style.fontWeight = 'bold';\n        mapButton.style.fontSize = '14px';\n        mapButton.style.color = '#666';\n        mapButton.onclick = () => {\n          this.map.setMapTypeId('roadmap');\n          mapButton.style.color = '#1a73e8';\n          satelliteButton.style.color = '#666';\n        };\n        \n        // 创建卫星按钮\n        const satelliteButton = document.createElement('div');\n        satelliteButton.textContent = 'Satellite';\n        satelliteButton.style.padding = '8px 16px';\n        satelliteButton.style.cursor = 'pointer';\n        satelliteButton.style.fontFamily = 'Arial, sans-serif';\n        satelliteButton.style.fontWeight = 'bold';\n        satelliteButton.style.fontSize = '14px';\n        satelliteButton.style.color = '#666';\n        satelliteButton.onclick = () => {\n          this.map.setMapTypeId('satellite');\n          satelliteButton.style.color = '#1a73e8';\n          mapButton.style.color = '#666';\n        };\n        \n        // 添加按钮到控件\n        customMapTypeControlDiv.appendChild(mapButton);\n        customMapTypeControlDiv.appendChild(satelliteButton);\n        \n        // 创建地图\n        this.map = new google.maps.Map(mapContainer, {\n          center: center,\n          zoom: 7,\n          language: 'en', // 设置地图语言为英文\n          region: 'IE',   // 设置地区为爱尔兰\n          mapTypeControl: false, // 关闭默认地图类型控制器\n          zoomControl: true,\n          streetViewControl: true,\n          fullscreenControl: true\n        });\n        \n        // 将自定义控件添加到地图上\n        this.map.controls[google.maps.ControlPosition.TOP_LEFT].push(customMapTypeControlDiv);\n\n        // 如果表单中已有经纬度，添加标记\n        if (this.restaurantForm.lat && this.restaurantForm.lng) {\n          this.addMarker(center);\n        }\n\n        // 添加地图点击事件\n        this.map.addListener('click', (event) => {\n          const position = {\n            lat: event.latLng.lat(),\n            lng: event.latLng.lng()\n          };\n          \n          // 更新表单中的经纬度\n          this.restaurantForm.lat = position.lat.toFixed(6);\n          this.restaurantForm.lng = position.lng.toFixed(6);\n          \n          // 添加或更新标记\n          this.addMarker(position);\n          \n          // 尝试反向地理编码获取地址\n          this.reverseGeocode(position);\n        });\n        \n        this.mapError = null;\n      } catch (error) {\n        this.mapError = 'Map initialization failed: ' + error.message;\n        console.error('Map initialization error:', error);\n      }\n    },\n    \n    addMarker(position) {\n      // 如果已有标记，先移除\n      if (this.marker) {\n        this.marker.setMap(null);\n      }\n      \n      // 创建新标记\n      this.marker = new google.maps.Marker({\n        position: position,\n        map: this.map,\n        draggable: true,\n        animation: google.maps.Animation.DROP\n      });\n      \n      // 添加拖拽事件\n      this.marker.addListener('dragend', (event) => {\n        const position = {\n          lat: event.latLng.lat(),\n          lng: event.latLng.lng()\n        };\n        \n        // 更新表单中的经纬度\n        this.restaurantForm.lat = position.lat.toFixed(6);\n        this.restaurantForm.lng = position.lng.toFixed(6);\n        \n        // 尝试反向地理编码获取地址\n        this.reverseGeocode(position);\n      });\n    },\n    \n    reverseGeocode(position) {\n      // 仅当表单地址为空或地图直接点击操作时才尝试反向地理编码\n      if (!this.restaurantForm.address || this.restaurantForm.address.trim() === '') {\n        const geocoder = new google.maps.Geocoder();\n        geocoder.geocode({ location: position }, (results, status) => {\n          if (status === 'OK' && results[0]) {\n            this.restaurantForm.address = results[0].formatted_address;\n          }\n        });\n      }\n    },\n    \n    geocodeAddress(address) {\n      if (window.google && window.google.maps) {\n        const geocoder = new google.maps.Geocoder();\n        geocoder.geocode({ address: address }, (results, status) => {\n          if (status === 'OK' && results[0]) {\n            const position = {\n              lat: results[0].geometry.location.lat(),\n              lng: results[0].geometry.location.lng()\n            };\n            \n            // 更新表单中的经纬度\n            this.restaurantForm.lat = position.lat.toFixed(6);\n            this.restaurantForm.lng = position.lng.toFixed(6);\n            \n            // 添加或更新标记并移动地图\n            this.addMarker(position);\n            this.map.setCenter(position);\n            this.map.setZoom(15);\n          }\n        });\n      }\n    },\n    \n    manageMenu(restaurant) {\n      // 先保存当前选中的餐厅ID到本地存储\n      localStorage.setItem('selectedRestaurantId', restaurant.id);\n      // 导航到菜单管理页面\n      this.$router.push('/menu-management');\n    },\n    \n    copyCoordinates() {\n      const lat = parseFloat(this.restaurantForm.lat);\n      const lng = parseFloat(this.restaurantForm.lng);\n      \n      if (!isNaN(lat) && !isNaN(lng)) {\n        // 格式化为6位小数并组合经纬度\n        const coordString = `${lat.toFixed(6)},${lng.toFixed(6)}`;\n        \n        // 尝试使用现代剪贴板API\n        navigator.clipboard.writeText(coordString)\n          .then(() => {\n            this.$message.success(`Coordinates copied: ${coordString}`);\n          })\n          .catch(err => {\n            // 如果剪贴板API不可用，使用备用方法\n            this.fallbackCopyToClipboard(coordString);\n          });\n      } else {\n        this.$message.warning('Invalid coordinates');\n      }\n    },\n    \n    fallbackCopyToClipboard(text) {\n      // 创建一个临时输入元素\n      const textArea = document.createElement('textarea');\n      textArea.value = text;\n      \n      // 避免滚动到底部\n      textArea.style.position = 'fixed';\n      textArea.style.left = '-999999px';\n      textArea.style.top = '-999999px';\n      document.body.appendChild(textArea);\n      \n      // 选择文本并复制\n      textArea.focus();\n      textArea.select();\n      \n      try {\n        const successful = document.execCommand('copy');\n        if (successful) {\n          this.$message.success(`Coordinates copied: ${text}`);\n        } else {\n          this.$message.error('Failed to copy coordinates');\n        }\n      } catch (err) {\n        this.$message.error('Failed to copy coordinates: ' + err);\n      }\n      \n      document.body.removeChild(textArea);\n    },\n    \n    splitCoordinates() {\n      if (!this.combinedCoordinates) return;\n      \n      // 使用正则表达式匹配坐标格式\n      const coordPattern = /^\\s*(-?\\d+\\.?\\d*)\\s*,\\s*(-?\\d+\\.?\\d*)\\s*$/;\n      const match = this.combinedCoordinates.match(coordPattern);\n      \n      if (match) {\n        const lat = parseFloat(match[1]);\n        const lng = parseFloat(match[2]);\n        \n        // 验证经纬度范围\n        if (lat >= -90 && lat <= 90 && lng >= -180 && lng <= 180) {\n          this.restaurantForm.lat = lat.toFixed(6);\n          this.restaurantForm.lng = lng.toFixed(6);\n          \n          // 如果地图已初始化，移动地图到该位置\n          if (this.map) {\n            const position = { lat, lng };\n            this.addMarker(position);\n            this.map.setCenter(position);\n            this.map.setZoom(15);\n          }\n        } else {\n          this.$message.error('Invalid coordinates: Latitude must be between -90 and 90, Longitude between -180 and 180');\n        }\n      } else {\n        this.$message.warning('Please enter coordinates in format: \"latitude,longitude\" (e.g. 53.452940,-7.099791)');\n      }\n    },\n    \n    updateCombinedCoordinates() {\n      if (!this.restaurantForm.lat || !this.restaurantForm.lng) return;\n      \n      try {\n        const lat = parseFloat(this.restaurantForm.lat);\n        const lng = parseFloat(this.restaurantForm.lng);\n        \n        if (!isNaN(lat) && !isNaN(lng)) {\n          this.combinedCoordinates = `${lat.toFixed(6)},${lng.toFixed(6)}`;\n        }\n      } catch (e) {\n        console.error('Error updating combined coordinates:', e);\n      }\n    }\n  }\n};\n</script>\n\n<style scoped>\n.restaurant-management {\n  padding: 20px;\n  max-width: 1200px;\n  margin: 0 auto;\n}\n\nh2 {\n  margin-bottom: 20px;\n  color: #333;\n}\n\nh3 {\n  margin-bottom: 15px;\n  color: #666;\n}\n\n.restaurant-form {\n  background: #f9f9f9;\n  padding: 20px;\n  border-radius: 8px;\n  margin-bottom: 30px;\n}\n\n.location-inputs {\n  display: flex;\n  gap: 10px;\n  margin-bottom: 10px;\n}\n\n.location-input {\n  width: 50%;\n}\n\n.map-container {\n  position: relative;\n  margin-top: 10px;\n  border: 1px solid #ddd;\n  border-radius: 4px;\n  overflow: hidden;\n}\n\n.map-error {\n  position: absolute;\n  top: 50%;\n  left: 50%;\n  transform: translate(-50%, -50%);\n  background-color: rgba(255, 0, 0, 0.7);\n  color: white;\n  padding: 8px 16px;\n  border-radius: 4px;\n}\n\n.map-tip {\n  color: #909399;\n  font-size: 12px;\n  margin-bottom: 5px;\n}\n\n.restaurant-list {\n  margin-top: 30px;\n}\n\n.combined-input {\n  margin-bottom: 10px;\n  border: 1px solid #dcdfe6;\n  border-radius: 4px;\n  padding: 10px;\n  background-color: #f5f7fa;\n}\n\n.combined-input :deep(.el-input__inner) {\n  font-family: monospace;\n  font-size: 14px;\n}\n\n.combined-input :deep(.el-input-group__append) {\n  background-color: #409EFF;\n  border-color: #409EFF;\n  color: white;\n}\n</style> "]}]}